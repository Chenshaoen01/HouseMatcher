@model HouseMatcher.Models.HouseListViewModel
<div class="homepage-header d-flex justify-content-center p-5"
     data-aos="fade-down" data-aos-duration="2000" data-aos-once="true">
    @Html.Partial("SearchArea")
</div>
<div class="homepage-carousel py-5"
     data-aos="fade-down" data-aos-duration="2000" data-aos-once="true">
    <button type="button" class="homepage-carousel-button homepage-carousel-button-pre">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
        </svg>
    </button>
    <button type="button" class="homepage-carousel-button homepage-carousel-button-next">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
        </svg>
    </button>
    <div class="homepage-carousel-content owl-carousel">
        @{
            foreach(var house in Model.HouseList)
            {
                string HouseImgUrl = "/" + house.HouseImg;
                <a href="@Url.Action("Detail", "House", new { Id = house.HouseId})"
                   class="d-block position-relative text-black text-decoration-none">
                    <div class="homepage-carousel-content-item" style="background-image: url('@HouseImgUrl')"></div>
                    <div class="homepage-carousel-content-info">
                        <p class="homepage-carousel-content-title">@house.HouseName</p>
                        <p class="homepage-carousel-content-text">NT$ @house.RentPerMonth/月</p>
                        <p class="homepage-carousel-content-text">地點：@house.Location</p>
                        <p class="homepage-carousel-content-text">坪數：@house.HouseSize 坪</p>
                        <div class="d-flex">
                            @{
                                foreach(var feature in house.FeaturLabelList)
                                {
                                    <span class="feature-label">@feature.LabelName</span>
                                }
                            } 
                        </div>
                    </div>
                </a>
            }
        }
    </div>
</div>

<div class="main-content mx-auto">
    <div class="containter-fluid">
        <div class="row justify-content-center align-items-stretch mb-5"
             data-aos="fade-right" data-aos-duration="2000" data-aos-once="true">
            <div class="col-12 col-md-7">
                <div class="homepage-intro-img-box homepage-intro-img-box-map"></div>
            </div>
            <div class="col-12 col-md-5">
                <div class="d-none d-md-block homepage-intro-line homepage-intro-line-first ms-auto"></div>
                <div class="d-flex flex-column align-items-center align-items-md-end my-4">
                    <p class="text-black fw-bold fs-1 mb-0">地圖尋屋</p>
                    <p class="text-black fw-bold fs-5 mb-0">結合地圖系統</p>
                    <p class="text-black fw-bold fs-5 mb-0">讓你尋找周邊房屋</p>
                </div>
            </div>
        </div>
        <div class="row flex-column-reverse flex-md-row justify-content-center align-items-stretch mb-5"
             data-aos="fade-left" data-aos-duration="2000" data-aos-once="true">
            <div class="col-12 col-md-5">
                <div class="d-none d-md-block homepage-intro-line homepage-intro-line-second"></div>
                <div class="d-flex flex-column align-items-center align-items-md-start my-4">
                    <p class="text-black fw-bold fs-1 mb-0">即時訊息</p>
                    <p class="text-black fw-bold fs-5 mb-0">即時訊息聯絡</p>
                    <p class="text-black fw-bold fs-5 mb-0">預約看屋方便快速</p>
                </div>
            </div>
            <div class="col-12 col-md-7">
                <div class="homepage-intro-img-box homepage-intro-img-box-message"></div>
            </div>
        </div>
    </div>
</div>

<div class="d-flex justify-content-center">
    <div class="main-content container-fluid py-5">
        <div class="number-scroll-area row justify-content-center g-5">
            <div class="col-10 col-md-5">
                <div class="homepage-introduce-circle mx-auto">
                    <span class="text-white w-25 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="currentColor" class="bi bi-copy" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                        </svg>
                    </span>
                    <div class="post-amout fs-1">
                        <span id="totalPostNum" class="scroll-num"></span><span class="ms-1">+</span>
                    </div>
                    <p class="text-white fw-bold fs-5">會員人數</p>
                </div>
            </div>
            <div class="col-10 col-md-5">
                <div class="homepage-introduce-circle mx-auto">
                    <span class="text-white w-25 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="currentColor" class="bi bi-clipboard2-check" viewBox="0 0 16 16">
                            <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z" />
                            <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z" />
                            <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0z" />
                        </svg>
                    </span>
                    <div class="post-amout fs-1">
                        <span id="match-num-this-month" class="scroll-num"></span><span class="ms-1">+</span>
                    </div>
                    <p class="text-white fw-bold fs-5">本月媒合成功</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const carouselElement = document.getElementById('homepage-carousel')
    $('.owl-carousel').owlCarousel({
        loop: true,
        margin: 50,
        nav: true,
        center: true,
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1.25
            }
        }
    })

    $(document).on('click', '.homepage-carousel-button-pre', function () {
        $('.owl-carousel').trigger('prev.owl.carousel');
    })

    $(document).on('click', '.homepage-carousel-button-next', function () {
        $('.owl-carousel').trigger('next.owl.carousel');
    })


    // 數字滾動
    // let targetNumItem = null

    function scrollNumber(targetId, digits) {
        const targetNumItem = document.querySelector(`#${targetId}`)
        targetNumItem.querySelectorAll('span[data-value]').forEach((tick, i) => {
            const targetNum = digits[i]
            tick.style.transform = `translateY(-${100 * parseInt(digits[i])}%)`;
        })

        setTimeout(() => {
            targetNumItem.style.width = `${digits.length * 28}px`;
        }, 100)
    }

    function addDigit(targetId, digit, fresh) {
        const targetNumItem = document.querySelector(`#${targetId}`)
        const spanList = Array(10)
            .join(0)
            .split(0)
            .map((x, j) => `<span>${j}</span>`)
            .join('')

        targetNumItem.insertAdjacentHTML(
            "beforeend",
            `<span style="transform: translateY(-1000%)" data-value="${digit}">
            ${spanList}
          </span>`)

        const firstDigit = targetNumItem.lastElementChild

        setTimeout(() => {
            firstDigit.className = "visible";
        }, true ? 0 : 0000);
    }

    function setup(targetId, startNum) {
        // targetNumItem = document.querySelector(`#${targetId}`)

        const digits = startNum.toString().split('')

        for (let i = 0; i < digits.length; i++) {
            addDigit(targetId, '0', true)
        }

        scrollNumber(targetId, ['0'])

        setTimeout(() => scrollNumber(targetId, digits), 0000)
    }

    let isScrolled = false
    $(document).ready(function () {
        // 定義一個函數來檢查特定元素是否進入了畫面
        function isElementInViewport(el) {
            var rect = el.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }

        // 在滾動事件發生時檢查 .number-scroll-area 是否進入畫面
        $(window).on('scroll', function () {
            $('.number-scroll-area').each(function () {
                if (isElementInViewport(this)) {
                    if (!isScrolled) {
                        // 如果進入畫面，則執行相應的函數
                        setup('totalPostNum', 521);
                        setup('match-num-this-month', 123);
                    }

                    isScrolled = true
                }
            });
        });
    });
</script>